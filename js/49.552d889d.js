"use strict";(self["webpackChunkvueproject"]=self["webpackChunkvueproject"]||[]).push([[49],{2049:function(e,t,i){i.r(t),i.d(t,{default:function(){return d}});var s=function(){var e=this,t=e._self._c;return t("el-container",[t("el-header",{staticClass:"el-icon-connection",staticStyle:{"font-size":"48px","background-color":"rgb(112, 204, 190)"}},[e._v("---交流论坛")]),t("el-main",[t("el-button",{on:{click:function(t){e.dialogVisible=!0}}},[e._v("发布观点")]),t("el-dialog",{attrs:{title:"发布帖子",visible:e.dialogVisible,width:"30%","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("span",[t("el-form",{ref:"form",attrs:{model:e.message,"show-message":"80px"}},[t("el-form-item",{attrs:{label:"title"}},[t("el-input",{staticStyle:{width:"84%"},attrs:{placeholder:"标题不超过20个字",maxlength:"20","show-word-limit":""},model:{value:e.message.title,callback:function(t){e.$set(e.message,"title",t)},expression:"message.title"}})],1),t("el-form-item",{attrs:{label:"content"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:6},placeholder:"请输入内容,小于420字",maxlength:"420","show-word-limit":""},model:{value:e.message.content,callback:function(t){e.$set(e.message,"content",t)},expression:"message.content"}})],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.post}},[e._v("发布")])],1)]),e._l(this.info_item,(function(i){return t("div",{key:i.title,staticStyle:{"background-color":"rgb(219, 219, 219)"}},[t("p",{staticStyle:{"font-weight":"bold"}},[t("span",{staticStyle:{color:"red"}},[e._v("主题: "+e._s(i.title))]),e._v("      "),t("span",{staticStyle:{color:"rgb(112, 204, 190)"}},[e._v("发布者:  "+e._s(i.user))]),e._v("      发布时间:  "+e._s(i.time)),t("span",{staticStyle:{color:"rgb(217, 120, 250)"}},[e._v("      文章id:  "+e._s(i.collect_id))])]),t("p",[e._v(e._s(i.content))]),t("el-button",{staticStyle:{float:"right"},attrs:{type:"primary",icon:"el-icon-star-off",circle:"true",round:"true"},on:{click:function(t){return e.collect(i)}}},[e._v(e._s(i.flag))]),t("br"),t("br"),t("hr")],1)}))],2)],1)},a=[],l=(i(4114),i(347));const o=i(6425);var n={data(){return{User:{name:l.A.user.username},dialogVisible:!1,message:{title:"",content:"",time:"",collect_id:""},info_item:[]}},methods:{post(){if(""==this.message.title)this.$alert("标题不能为空","警告",{confirmButtonText:"确定",callback:e=>{this.$message({type:"info",message:`action: ${e}`})}});else if(""==this.message.content)this.$alert("内容不能为空","警告",{confirmButtonText:"确定",callback:e=>{this.$message({type:"info",message:`action: ${e}`})}});else{const e=new Date,t=e.getFullYear(),i=("0"+(e.getMonth()+1)).slice(-2),s=("0"+e.getDate()).slice(-2),a=("0"+e.getHours()).slice(-2),n=("0"+e.getMinutes()).slice(-2),r=("0"+e.getSeconds()).slice(-2);this.message.time=t+"年"+i+"月"+s+"日"+a+"时"+n+"分"+r+"秒",this.message.collect_id=this.User.name+t+s+a+n+r,o.post(l.A.url+"/publish",{user_name:this.User.name,title:this.message.title,content:this.message.content,time:this.message.time,collect_id:this.message.collect_id},{headers:{"Content-Type":"application/x-www-form-urlencoded"},emulateJSON:!0}).then((e=>{if(e.data){this.$message({message:"发布成功",type:"success",duration:1e3}),this.info_item=[];for(var t=0;t<e.data.length;t++){var i={};i["title"]=e.data[t]["title"],i["user"]=e.data[t]["user"],i["content"]=e.data[t]["content"],i["time"]=e.data[t]["time"],i["collect_id"]=e.data[t]["collect_id"],i["flag"]=e.data[t]["flag"],this.info_item.push(i)}o.post(l.A.url+"/collect/get_info",{username:l.A.user.username,collect_type:"论坛文章"},{headers:{"Content-Type":"application/x-www-form-urlencoded"},emulateJSON:!0}).then((e=>{for(var t=0;t<this.info_item.length;t++)this.info_item[t].flag="未收藏";if(e.data)for(var i=0;i<e.data.length;i++)for(var s=0;s<this.info_item.length;s++)if(this.info_item[s].collect_id==e.data[i].collect_id){this.info_item[s].flag="已收藏";break}}))}})),this.dialogVisible=!1}},collect(e){o.post(l.A.url+"/collect/collected",{username:l.A.user.username,password:l.A.user.password,collect_id:e.collect_id,collect_type:"论坛文章",flag:e.flag},{headers:{"Content-Type":"application/x-www-form-urlencoded"},emulateJSON:!0}).then((t=>{t.data&&("已收藏"==e.flag?this.$message({message:"取消收藏成功",type:"success",duration:1e3}):this.$message({message:"收藏成功",type:"success",duration:1e3}),o.post(l.A.url+"/collect/get_info",{username:l.A.user.username,collect_type:"论坛文章"},{headers:{"Content-Type":"application/x-www-form-urlencoded"},emulateJSON:!0}).then((e=>{for(var t=0;t<this.info_item.length;t++)this.info_item[t].flag="未收藏";if(e.data)for(var i=0;i<e.data.length;i++)for(var s=0;s<this.info_item.length;s++)if(this.info_item[s].collect_id==e.data[i].collect_id){this.info_item[s].flag="已收藏";break}})))}))}},mounted(){l.A.user.username&&l.A.user.password?o.post(l.A.url+"/load_message",{headers:{"Content-Type":"application/x-www-form-urlencoded"},emulateJSON:!0}).then((e=>{if(this.info_item=[],e.data){for(var t=0;t<e.data.length;t++){var i={};i["title"]=e.data[t]["title"],i["user"]=e.data[t]["user"],i["content"]=e.data[t]["content"],i["time"]=e.data[t]["time"],i["collect_id"]=e.data[t]["collect_id"],i["flag"]=e.data[t]["flag"],this.info_item.push(i)}console.log(this.info_item),o.post(l.A.url+"/collect/get_info",{username:l.A.user.username,collect_type:"论坛文章"},{headers:{"Content-Type":"application/x-www-form-urlencoded"},emulateJSON:!0}).then((e=>{if(e.data)for(var t=0;t<e.data.length;t++)for(var i=0;i<this.info_item.length;i++)if(this.info_item[i].collect_id==e.data[t].collect_id){this.info_item[i].flag="已收藏";break}}))}})):(this.$message.error("你还没有登录账号，禁止访问其他页面！！！"),this.$router.push("/log"))}},r=n,c=i(1656),m=(0,c.A)(r,s,a,!1,null,null,null),d=m.exports}}]);
//# sourceMappingURL=49.552d889d.js.map